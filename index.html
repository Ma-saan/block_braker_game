<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#000000">
  <title>ブロック崩し</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
      overflow: hidden;
      touch-action: none;
      position: fixed;
    }
    
    #game-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    canvas {
      display: block;
      margin: 0 auto;
      /* キャンバスの拡大縮小をスムーズに */
      transition: width 0.3s ease, height 0.3s ease;
    }
    
    #orientation-message {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      color: white;
      text-align: center;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      font-size: 24px;
      font-family: Arial, sans-serif;
    }
    
    #orientation-message img {
      width: 120px;
      height: 120px;
      margin-bottom: 20px;
      animation: rotate 1.5s infinite ease-in-out;
    }
    
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(90deg); }
    }
    
    /* モバイルデバイスでの表示を最適化 */
    @media (max-width: 768px) {
      canvas {
        max-width: 100%;
        max-height: 100%;
      }
    }
  </style>
</head>
<body>
  <div id="game-container"></div>
  
  <!-- 向き指示メッセージ（必要な場合に表示） -->
  <div id="orientation-message">
    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjEyMCIgaGVpZ2h0PSIxMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSI1IiB5PSIyIiB3aWR0aD0iMTQiIGhlaWdodD0iMjAiIHJ4PSIyIiByeT0iMiIvPjxsaW5lIHgxPSIxMiIgeTE9IjE4IiB4Mj0iMTIiIHkyPSIxOCIvPjwvc3ZnPg==" alt="端末を回転">
    <p>最高のプレイ体験のため<br>端末を回転させてください</p>
  </div>
  
  <!-- Phaser CDNを追加 -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  
  <!-- 相対パスに変更 -->
  <script type="module" src="./src/main.js"></script>
  <script>
    // 向き指示メッセージを制御する変数
    let preferLandscape = false;
    let orientationMessage;
    
    // DOMコンテンツがロードされた後に要素を取得
    document.addEventListener('DOMContentLoaded', function() {
      orientationMessage = document.getElementById('orientation-message');
    });
    
    // 画面のスクロールを防止
    document.addEventListener('touchmove', function(e) {
      if (e.touches.length > 1 || e.scale !== 1) {
        e.preventDefault();
      }
    }, { passive: false });
    
    document.body.addEventListener('touchstart', function(e) {
      if (e.touches.length > 1) {
        e.preventDefault();
      }
    }, { passive: false });
    
    // iOS Safari向けのフルスクリーン対応
    function goFullScreen() {
      const gameContainer = document.getElementById('game-container');
      
      if (document.fullscreenElement) {
        return; // すでにフルスクリーン
      }
      
      // 様々なブラウザ向けのフルスクリーンAPI
      if (gameContainer.requestFullscreen) {
        gameContainer.requestFullscreen();
      } else if (gameContainer.webkitRequestFullscreen) {
        gameContainer.webkitRequestFullscreen();
      } else if (gameContainer.msRequestFullscreen) {
        gameContainer.msRequestFullscreen();
      } else if (document.documentElement.webkitRequestFullScreen) {
        // iOS Safari特有の対応
        document.documentElement.webkitRequestFullScreen();
      }
      
      // スクロールを一番上に
      setTimeout(() => {
        window.scrollTo(0, 0);
      }, 100);
    }
    
    // 向きが変わったときの処理
    function checkOrientation() {
      // 管理しやすくするために明示的に向きを計算
      const isLandscape = window.innerWidth > window.innerHeight;
      
      // 要素が取得できていることを確認
      if (orientationMessage) {
        // ゲームが横向きを優先する場合の処理
        if (preferLandscape && !isLandscape) {
          // 縦向きで表示しているときに警告表示
          orientationMessage.style.display = 'flex';
        } else {
          // それ以外の場合は警告を隠す
          orientationMessage.style.display = 'none';
        }
      }
      
      // スクロールをリセット
      window.scrollTo(0, 0);
      
      // ゲームがロードされている場合はリフレッシュ
      if (window.game && window.game.scale) {
        setTimeout(() => window.game.scale.refresh(), 100);
      }
    }
    
    // 画面タップでフルスクリーン
    document.addEventListener('click', goFullScreen, { once: true });
    document.addEventListener('touchstart', goFullScreen, { once: true });
    
    // 画面回転時の処理
    window.addEventListener('orientationchange', function() {
      setTimeout(() => {
        checkOrientation();
      }, 200);
    });
    
    // 画面サイズ変更時にも向きをチェック
    window.addEventListener('resize', function() {
      setTimeout(() => {
        checkOrientation();
      }, 200);
    });
    
    // ページロード完了時の処理
    window.addEventListener('load', function() {
      // ゲームの向きに応じた設定
      // モバイル端末でプレイする場合は、必要に応じてpreferLandscapeをtrueに変更
      preferLandscape = false; // 必要に応じてゲームの推奨向きを設定
      
      setTimeout(() => {
        window.scrollTo(0, 0);
        checkOrientation();
      }, 100);
      
      // iOS 13以降のため、初回タップでオーディオコンテキストを起動
      document.addEventListener('touchstart', function() {
        if (window.game && window.game.sound && window.game.sound.context) {
          window.game.sound.context.resume();
        }
      }, { once: true });
    });
  </script>
</body>
</html>